<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">

  <link rel="stylesheet" href="lib/codemirror.css">
  <link rel="stylesheet" href="theme/icecoder.css"> 
  <link rel="stylesheet" href="mode/composition-mod/codemirror-composition-mod.css"> 

  <style>
  html,body {
    margin: 0;
    padding: 0;
  }
  .CodeMirror {
    padding-top: 15px;
    padding-left: 1%;
    padding-right: 1%;
    padding-bottom: 15px;
  }
  .CodeMirror-scroll {
    padding-bottom: 31px;
  }
  </style>     

  <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
  <script src="lib/codemirror.js"></script>
  <script src="addon/mode/overlay.js"></script>
  <script src="mode/gfm/gfm.js"></script>
  <script src="mode/go/go.js"></script>
  <script src="mode/markdown/markdown.js"></script>
  <script src="mode/composition-mod/codemirror-composition-mod.js"></script>
 
  <!--
  <script src="mode/meta.js"></script>
  <script src="mode/css/css.js"></script>
  <script src="mode/php/php.js"></script>
  <script src="mode/javascript/javascript.js"></script>
  <script src="mode/xml/xml.js"></script>
  -->
 
</head>
<body>
  
  <div id="header" style="height:20px">Test page of markdown-highlighter by codemirror.</div>
<textarea id="code">
# golang

- try to write 'hello world' script.


```go
package main 
import (
  "fmt"
)
func main () {
  fmt.println('hello world !');
}
```
</textarea>
  <div id="footer" style="height:20px">Test page of markdown-highlighter by codemirror.</div>
  
  <script>
  (function(){

      // pass to string.replace for camel to hyphen
      var hyphenate = function(a, b, c){
        return b + "-" + c.toLowerCase();
      }

      // get computed style property
      var getStyle = function(target, prop){
        if(window.getComputedStyle){ // gecko and webkit
          prop = prop.replace(/([a-z])([A-Z])/, hyphenate);  // requires hyphenated, not camel
          return window.getComputedStyle(target, null).getPropertyValue(prop);
        }
        if(target.currentStyle){
          return target.currentStyle[prop];
        }
        return target.style[prop];
      }

      // get object with units
      var getUnits = function(target, prop){

        var baseline = 100;  // any number serves 
        var item;  // generic iterator

        var map = {  // list of all units and their identifying string
          pixel : "px",
          percent : "%",
          inch: "in",
          cm : "cm",
          mm : "mm",
          point : "pt",
          pica : "pc",
          em : "em",
          ex : "ex"
        };

        var factors = {};  // holds ratios
        var units = {};  // holds calculated values

        var value = getStyle(target, prop);  // get the computed style value

        var numeric = value.match(/\d+/);  // get the numeric component
        if(numeric === null) {  // if match returns null, throw error...  use === so 0 values are accepted
          throw "Invalid property value returned";
        }
        numeric = numeric[0];  // get the string

        var unit = value.match(/\D+$/);  // get the existing unit
        unit = (unit == null) ? map.pixel : unit[0]; // if its not set, assume px - otherwise grab string

        var activeMap;  // a reference to the map key for the existing unit
        for(item in map){
          if(map[item] == unit){
            activeMap = item;
            break;
          }
        }
        if(!activeMap) { // if existing unit isn't in the map, throw an error
          throw "Unit not found in map";
        }

        var temp = document.createElement("div");  // create temporary element
        temp.style.overflow = "hidden";  // in case baseline is set too low
        temp.style.visibility = "hidden";  // no need to show it

        target.parentElement.appendChild(temp); // insert it into the parent for em and ex  

        for(item in map){  // set the style for each unit, then calculate it's relative value against the baseline
          temp.style.width = baseline + map[item];
          factors[item] = baseline / temp.offsetWidth;
        }

        for(item in map){  // use the ratios figured in the above loop to determine converted values
          units[item] = numeric * (factors[item] * factors[activeMap]);
        }

        target.parentElement.removeChild(temp);  // clean up

        return units;  // returns the object with converted unit values...

      }

      // expose           
      window.getUnits = this.getUnits = getUnits;

  })();
  </script>

  <script>
  var blur = function() {
  }          
  var renderLine = function(cm, line, elem) {
        console.log("#renderLine ",cm,line,elem);
  }
  var resize = function(editor) {
    var ih = Number(innerHeight) - 70;
    var obj = getUnits(document.body,'width');
    var iw = Number(obj.point) - 24;
    editor.setSize(null,ih); 
  }
  var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
      mode: 'gfm',
  //    theme: 'icecoder',
  //    lineWrapping: true,
      enableCompositionMod: true,
      debugCompositionMod: true,
      viewportMargin: Infinity
  });
  editor.on('blur', blur);
  editor.on('renderLine', renderLine);
  window.onresize = function(){resize(editor)};
  resize(editor);
  </script>
  <script id="__bs_script__">//<![CDATA[
  document.write("<script async src='http://HOST:3000/browser-sync/browser-sync-client.js?v=2.16.0'><\/script>".replace("HOST", location.hostname));
  //]]></script>
</body>
</html>
